/* ─── Message Bubble ─────────────────────────────────────── */

.chorus-bubble {
  display: flex;
  gap: var(--space-2, 0.5rem);
  padding: var(--space-1, 0.25rem) var(--space-4, 1rem);
  transition: background var(--motion-micro, 100ms), box-shadow var(--motion-micro, 100ms);
}

.chorus-bubble:hover {
  background: var(--chorus-message-hover-bg);
  box-shadow: var(--chorus-elevation-1);
  border-radius: var(--radius-md, 0.5rem);
}

.chorus-bubble--compact {
  padding-left: calc(var(--space-4, 1rem) + 36px + var(--space-2, 0.5rem));
}

.chorus-bubble--mentioned {
  background: var(--chorus-mention-bg);
  box-shadow: inset 4px 0 0 var(--color-warning, #FBBF24), 0 0 16px rgba(251, 191, 36, 0.06);
  border-radius: var(--radius-md, 0.5rem);
}

.chorus-bubble--mentioned:hover {
  background: var(--chorus-mention-bg);
  filter: brightness(0.97);
  box-shadow: inset 4px 0 0 var(--color-warning, #FBBF24), 0 0 20px rgba(251, 191, 36, 0.1);
}

.chorus-bubble--pinned {
  border-left: 2px solid var(--color-primary, #4f46e5);
  background: rgba(79, 70, 229, 0.04);
}

/* ── System message ─────────────────────────── */

.chorus-bubble--system {
  justify-content: center;
  padding: var(--space-2, 0.5rem) var(--space-4, 1rem);
  animation: none;
}

.chorus-bubble--system:hover {
  background: transparent;
  box-shadow: none;
}

.chorus-bubble__system-text {
  font-size: var(--text-xs, 0.75rem);
  color: var(--text-muted);
  font-style: italic;
}

/* ── Avatar ──────────────────────────────────── */

.chorus-bubble__avatar {
  flex-shrink: 0;
  padding-top: 2px;
}

/* ── Body ────────────────────────────────────── */

.chorus-bubble__body {
  flex: 1;
  min-width: 0;
}

/* ── Header ──────────────────────────────────── */

.chorus-bubble__header {
  display: flex;
  align-items: baseline;
  gap: var(--space-2, 0.5rem);
  margin-bottom: 2px;
}

.chorus-bubble__sender {
  font-size: var(--text-sm, 0.875rem);
  font-weight: var(--font-bold, 700);
  color: var(--text-primary);
}

.chorus-bubble__time {
  font-size: var(--text-xs, 0.75rem);
  color: var(--text-muted);
}

.chorus-bubble__compact-time {
  float: left;
  width: 0;
  white-space: nowrap;
  overflow: visible;
  margin-left: calc(-36px - var(--space-2, 0.5rem) - var(--space-4, 1rem) + var(--space-1, 0.25rem));
  font-size: 0.65rem;
  color: var(--text-muted);
  opacity: 0;
  transition: opacity var(--motion-micro, 100ms);
}

.chorus-bubble:hover .chorus-bubble__compact-time {
  opacity: 1;
}

.chorus-bubble__edited {
  font-size: var(--text-xs, 0.75rem);
  color: var(--text-muted);
  font-style: italic;
}

.chorus-bubble__pin-icon {
  color: var(--color-primary, #4f46e5);
  flex-shrink: 0;
}

/* ── Content ─────────────────────────────────── */

.chorus-bubble__content {
  font-size: var(--text-sm, 0.875rem);
  color: var(--text-primary);
  line-height: 1.5;
  word-break: break-word;
  white-space: pre-wrap;
}

.chorus-bubble__code-block {
  margin: var(--space-2, 0.5rem) 0;
  padding: var(--space-2, 0.5rem) var(--space-3, 0.75rem);
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md, 0.5rem);
  overflow-x: auto;
  font-family: 'SF Mono', 'Fira Code', monospace;
  font-size: var(--text-xs, 0.75rem);
  line-height: 1.6;
  white-space: pre;
  transition: border-color var(--motion-micro, 100ms), box-shadow var(--motion-micro, 100ms);
}

.chorus-bubble__code-block:hover {
  border-color: rgba(79, 70, 229, 0.25);
  box-shadow: 0 0 8px rgba(79, 70, 229, 0.06);
}

.chorus-bubble__inline-code {
  padding: 1px var(--space-1, 0.25rem);
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm, 0.375rem);
  font-family: 'SF Mono', 'Fira Code', monospace;
  font-size: 0.85em;
}

/* ── Cross-module reference ──────────────────── */

.chorus-bubble__cross-ref {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1, 0.25rem);
  margin-top: var(--space-2, 0.5rem);
  padding: var(--space-1, 0.25rem) var(--space-2, 0.5rem);
  font-size: var(--text-xs, 0.75rem);
  color: var(--color-primary, #4f46e5);
  background: rgba(79, 70, 229, 0.06);
  border: 1px solid rgba(79, 70, 229, 0.15);
  border-radius: var(--radius-sm, 0.375rem);
  text-decoration: none;
  transition: background var(--motion-micro, 100ms), transform var(--motion-micro, 100ms), box-shadow var(--motion-micro, 100ms);
}

.chorus-bubble__cross-ref:hover {
  background: rgba(79, 70, 229, 0.12);
  transform: translateY(-1px);
  box-shadow: var(--chorus-elevation-2);
}

/* ── Reactions ───────────────────────────────── */

.chorus-bubble__reactions {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-1, 0.25rem);
  margin-top: var(--space-1, 0.25rem);
}

.chorus-bubble__reaction {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  padding: 2px var(--space-2, 0.5rem);
  font-size: var(--text-xs, 0.75rem);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-full, 9999px);
  background: var(--bg-secondary);
  color: var(--text-secondary);
  cursor: pointer;
  transition: transform 100ms cubic-bezier(0.22, 1, 0.36, 1), border-color 100ms, background 100ms;
}

.chorus-bubble__reaction:hover {
  border-color: var(--color-primary, #4f46e5);
  transform: scale(1.15);
}

.chorus-bubble__reaction:active {
  transform: scale(0.95);
}

.chorus-bubble__reaction--active {
  border-color: rgba(79, 70, 229, 0.5);
  background: rgba(79, 70, 229, 0.08);
  box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.3);
}

.chorus-bubble__reaction-count {
  font-variant-numeric: tabular-nums;
}

/* ── Thread link ─────────────────────────────── */

.chorus-bubble__thread-link {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1, 0.25rem);
  margin-top: var(--space-1, 0.25rem);
  padding: var(--space-1, 0.25rem) var(--space-2, 0.5rem);
  font-size: var(--text-xs, 0.75rem);
  color: var(--color-primary, #4f46e5);
  background: transparent;
  border: none;
  border-radius: var(--radius-sm, 0.375rem);
  cursor: pointer;
  transition: background var(--motion-micro, 100ms), color var(--motion-micro, 100ms);
}

.chorus-bubble__thread-link:hover {
  background: rgba(79, 70, 229, 0.06);
  color: #6366f1;
}
