# Dev overrides: hot reload, debug ports, volume mounts
version: "3.9"

services:
  postgres:
    ports:
      - "5432:5432"

  redis:
    ports:
      - "6379:6379"

  # In dev, run the app with hot reload instead of built image
  app:
    build:
      context: .
      dockerfile: Dockerfile
      target: frontend-build  # Use build stage for dev
    command: ["sh", "-c", "cd server && npx tsx watch src/index.ts"]
    volumes:
      - ./server/src:/app/server/src
      - ./server/package.json:/app/server/package.json
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
    ports:
      - "3001:3001"
      - "9229:9229"  # Node.js debugger
